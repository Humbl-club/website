<section
  id="MainProduct-{{ section.id }}"
  data-section="{{ section.id }}"
  class="wrapper product product-desctop"
>
  <div id="ProductInfo-{{ section.id }}" class="product-sticky">
    <h1 class="product-title title-1 capitalize">{% render 'product-title' %}</h1>
    {% if section.settings.show_vendor %}
      <p class="headline-1">{{ product.vendor }}</p>
    {% endif %}

    {% for block in section.blocks %}
      {% case block.type %}
        {%- when 'price' -%}
          {% render 'price', product: product, use_variant: true, price_class: 'product-price headline-1' %}

        {%- when 'tab' -%}
          <details
            class="mobile-facets__details product-details"
            id="Details-{{ block.id }}-{{ section.id }}"
            {{ block.shopify_attributes }}
          >
            <summary class="mobile-facets__summary">
              <h2 class="body-1">
                {{ block.settings.title | default: block.settings.page.title }}
              </h2>
            </summary>
            <div class="mobile-facets__submenu body-1" id="ProductAccordion-{{ block.id }}-{{ section.id }}">
              {{ block.settings.content }}
              {{ block.settings.page.content }}
            </div>
          </details>
      {% endcase %}
    {% endfor %}
  </div>

  <ul class="product-images">
    {%- for media in product.media -%}
      {%- liquid
        assign is_first = false
        if forloop.first
          assign is_first = true
        endif
        assign loading = 'lazy'
        if is_first
          assign loading = 'eager'
        endif
      -%}
      <li class="product-img img-cover">
        {{
          media.preview_image
          | image_url: height: 745
          | image_tag: loading: loading, preload: forloop.first, width: 595, height: 745, alt: media.preview_image.alt
          | escape
        }}
      </li>
    {%- endfor -%}
  </ul>

  <div class="product-sticky">
    <button class="product-favorite body-1">
      {% render 'icon-favorite' %}
      Add to Wishlist
    </button>

    {% if product.available %}
      {% render 'product-colors' %}

      <div class="product-variants">
        <div class="product-subtitle body-1 opacity-50">Size:</div>

        <product-form client:idle class="relative">
          {%- assign product_form_id = 'product-form-' | append: section.id -%}
          {%- form 'product', product, id: product_form_id, class: 'form', data-type: 'add-to-cart-form' -%}
            <div class="product-form">
              {% render 'product-sizes',
                name: 'id',
                label: 'Size',
                options: product.variants,
                required: true,
                item: product,
                class: 'headline-2'
              %}
              <button
                type="submit"
                name="add"
                class="btn btn-blue product-submit"
              >
                {{ 'products.product.add_to_cart' | t }}
              </button>
            </div>
            <p class="body-2 absolute text-red-500" role="alert" data-error-message hidden></p>
          {%- endform -%}
        </product-form>
        {% if product.available %}
          <p class="body-3 text-center opacity-50">Few items left</p>
        {% else %}
          <p class="body-3 text-center opacity-50">Out of stock</p>
        {% endif %}
      </div>
    {% endif %}
  </div>

  {%- liquid
    if product.selected_or_first_available_variant.featured_media
      assign seo_media = product.selected_or_first_available_variant.featured_media
    else
      assign seo_media = product.featured_media
    endif
  -%}

  <script type="application/ld+json">
    {
      "@context": "http://schema.org/",
      "@type": "Product",
      "name": {{ product.title | json }},
      "url": {{ request.origin | append: product.url | json }},
      {% if seo_media -%}
        "image": [
          {{ seo_media | image_url: width: seo_media.preview_image.width | prepend: "https:" | json }}
        ],
      {%- endif %}
      "description": {{ product.description | strip_html | json }},
      {% if product.selected_or_first_available_variant.sku != blank -%}
        "sku": {{ product.selected_or_first_available_variant.sku | json }},
      {%- endif %}
      "brand": {
        "@type": "Brand",
        "name": {{ product.vendor | json }}
      },
      "offers": [
        {%- for variant in product.variants -%}
          {
            "@type" : "Offer",
            {%- if variant.sku != blank -%}
              "sku": {{ variant.sku | json }},
            {%- endif -%}
            {%- if variant.barcode.size == 12 -%}
              "gtin12": {{ variant.barcode }},
            {%- endif -%}
            {%- if variant.barcode.size == 13 -%}
              "gtin13": {{ variant.barcode }},
            {%- endif -%}
            {%- if variant.barcode.size == 14 -%}
              "gtin14": {{ variant.barcode }},
            {%- endif -%}
            "availability" : "http://schema.org/{% if variant.available %}InStock{% else %}OutOfStock{% endif %}",
            "price" : {{ variant.price | divided_by: 100.00 | json }},
            "priceCurrency" : {{ cart.currency.iso_code | json }},
            "url" : {{ request.origin | append: variant.url | json }}
          }{% unless forloop.last %},{% endunless %}
        {%- endfor -%}
      ]
    }
  </script>
</section>

{% schema %}
{
  "name": "Product information",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "Show product vendor",
      "default": false
    }
  ],
  "blocks": [
    {
      "type": "price",
      "name": "Price",
      "limit": 1
    },
    {
      "type": "tab",
      "name": "Tab",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Heading",
          "default": "Delivery and Returns"
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "Tab content",
          "default": "<p>Use collapsible tabs for more detailed information that will help customers make a purchasing decision.</p><p>Ex: Shipping and return policies, size guides, and other common questions.</p>"
        },
        {
          "type": "page",
          "id": "page",
          "label": "Tab content from page"
        }
      ]
    }
  ]
}
{% endschema %}
