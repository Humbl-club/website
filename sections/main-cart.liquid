<cart-items
  id="main-cart-items"
  data-id="{{ section.id }}"
  class="js-contents  {% if cart == empty %}is-empty{% endif %}"
>
  <h1 class="wrapper capitalize">
    {{ 'sections.cart.title' | t }}
    {% if cart != empty %}({{ cart.item_count }}){% endif %}
  </h1>

  <div class="cart-empty section-pt wrapper">
    <p class="headline-2">{{ 'sections.cart.empty' | t }}</p>
    <a
      href="{% if section.settings.collection %}{{ section.settings.collection.url }}{%else%}{{routes.all_products_collection_url}}{% endif %}"
      class="cart-link"
    >
      {{ 'general.continue_shopping' | t }}
    </a>
  </div>

  <ul class="cart-header headline-2 wrapper opacity-50 [.is-empty_&]:hidden">
    <li>Available now</li>
    <li>Quantity</li>
    <li>Price</li>
    <li>Total</li>
  </ul>

  <form action="{{ routes.cart_url }}" method="post" id="cart" class="cart-form wrapper [.is-empty_&]:hidden">
    {%- for item in cart.items -%}
      <div id="CartItem-{{ item.index | plus: 1 }}" class="cart-item wrapper-mobile">
        <div class="cart-img img-cover">
          {% if item.image %}
            {% comment %} Leave empty space due to a:empty CSS display: none rule {% endcomment %}
            <a href="{{ item.url }}" class="absolute inset-0 h-full w-full" tabindex="-1" aria-hidden="true"> </a>
            {% assign height_by_aspect = 134 | divided_by: item.image.aspect_ratio | floor %}
            <img
              src="{{ item.image | image_url: width: 134 }}"
              alt="{{ item.image.alt | escape }}"
              width="134"
              height="{{ height_by_aspect }}"
            >
          {% endif %}
        </div>
        <div class="cart-columns">
          <div class="cart-info">
            <h3>
              <a class="cart-item-name" href="{{ item.url }}">{{ item.product.title | escape }}</a>
            </h3>
            {%- if item.product.has_only_default_variant == false
              or item.properties.size != 0
              or item.selling_plan_allocation != null
            -%}
              <div class="cart-options body-3-mobile">
                <dl class="flex">
                  {% for option in item.options_with_values %}
                    <dt hidden>{{ option.name }}:</dt>
                    <dd>{{ option.value }}</dd>
                    {%- unless forloop.last -%}&nbsp;/&nbsp;{%- endunless -%}
                  {% endfor %}
                </dl>
              </div>

              {% if item.selling_plan_allocation.selling_plan.name %}
                <p>
                  {{ item.selling_plan_allocation.selling_plan.name }}
                </p>
              {% endif %}

              {% render 'cart-buttons', item: item.product, class: '--mobile-hidden' %}
            {%- endif -%}
          </div>

          <quantity-input class="quantity-input cart-quantity" client:visible>
            <button
              class="quantity-btn"
              type="button"
              name="minus"
              aria-label="{{ 'products.product.quantity.decrease' | t: product: item.product.title | escape }}"
            >
              {% render 'icon-minus' %}
            </button>
            <input
              class="quantity-input-field"
              type="number"
              name="updates[]"
              value="{{ item.quantity }}"
              min="0"
              max="{{ item.variant.inventory_quantity }}"
              aria-label="{{ 'products.product.quantity.input_label' | t: product: item.product.title | escape }}"
              id="Drawer-quantity-{{ item.index | plus: 1 }}"
              data-index="{{ item.index | plus: 1 }}"
            >
            <button
              class="quantity-btn {% if item.variant.inventory_quantity == item.quantity %} disabled {% endif %}"
              type="button"
              name="plus"
              aria-label="{{ 'products.product.quantity.increase' | t: product: item.product.title | escape }}"
            >
              {% render 'icon-plus' %}
            </button>
          </quantity-input>
          <div class="cart-price">
            {{ item.original_price | money }}
          </div>
          <div class="cart-total">
            {{ item.original_line_price | money }}
          </div>
          {% render 'cart-buttons', item: item.product, class: '--desctop-hidden' %}
        </div>

        <p
          id="Line-item-error-{{ item.index | plus: 1 }}"
          class="absolute bottom-0 left-0 text-red-500"
          role="alert"
        ></p>
      </div>
    {%- endfor -%}

    <div class="cart-note wrapper-mobile">
      <div id="cart-subtotal" class="cart-line cart-subtotal">
        {% render 'cart-subtotal' %}
      </div>
      {%- assign free_shipping = section.settings.price -%}
      <div class="cart-line">
        <h3 class="headline-2 opacity-50">{{ 'sections.cart.shipping' | t }}</h3>
        <p>{{- 'sections.cart.free_shipping' | t: count: free_shipping -}}</p>
      </div>
      <div class="cart-botnote">
        <noscript>
          <button
            type="submit"
            class="btn"
            form="cart"
          >
            {{ 'sections.cart.update' | t }}
          </button>
        </noscript>

        {%- if additional_checkout_buttons -%}
          <div class="cart-line cart-paypal">
            {{ content_for_additional_checkout_buttons }}
          </div>
        {%- endif -%}

        <button
          type="submit"
          id="checkout"
          class="btn btn-blue cart-checkout"
          name="checkout"
          {% if cart == empty %}
            disabled
          {% endif %}
          form="cart"
        >
          {{ 'sections.cart.checkout' | t }}
        </button>
      </div>
    </div>

    <div id="cart-spacer"></div>
    <script>
      const cartSpacer = document.getElementById('cart-spacer')
      if (cartSpacer) {
        cartSpacer.style.setProperty('padding-top', `${cartSpacer.previousElementSibling.offsetHeight}px`)
      }
    </script>

    <div class="wrapper-mobile">
      <p class="sr-only" id="cart-live-region-text" aria-live="polite" role="status"></p>
      <p class="sr-only" id="shopping-cart-line-item-status" aria-live="polite" aria-hidden="true" role="status">
        {{ 'accessibility.loading' | t }}
      </p>
    </div>
  </form>
</cart-items>

{% schema %}
{
  "name": "Cart page",
  "class": "cart-main",
  "settings": [
    {
      "type": "collection",
      "id": "collection",
      "info": "Link to collection page if cart is empty",
      "label": "Collection"
    },
    {
      "type": "number",
      "label": "Free price shipping",
      "id": "price",
      "default": 50
    }
  ]
}
{% endschema %}
