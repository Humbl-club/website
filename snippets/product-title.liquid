{% assign colors = '' %}
{%- assign ntitle = '' -%}
{% assign position_of_color = 0 %}
{%- assign no_color = false -%}
{% for option in product.options_with_values %}
  {% if option.name == 'Color' %}
    {%- assign position_of_color = option.position | minus: 1 -%}
    {%- for value in option.values -%}
      {% assign colors = colors | append: ',' | append: value | append: ',' %}
    {% endfor %}
  {% endif %}
{% endfor %}
{% if colors != '' %}
  {% for variant in product.variants %}
    {% assign ntitle_array = variant.title | split: '/ ' %}
    {% assign ntitle = ntitle_array[position_of_color] | strip %}
    {% assign ntitle = ',' | append: ntitle | append: ',' %}
    {% if colors contains ntitle %}
      {%- assign ntitle = ntitle | remove: ',' -%}
    {% endif %}
  {% endfor %}
{% else %}
  {%- assign no_color = true -%}
{% endif %}
{% if product.collections.size > 0 %}
  {% for collection in product.collections %}
    {% if collection.title != 'All colors' %}
      {% if collection.title != '' %}
        {{ collection.title | append: '&nbsp;| ' -}}
      {% endif %}
      {% if product.type != '' %}
        {{- product.type | append: '&nbsp;| ' }}
      {% endif %}
      {% if ntitle != '' %}
        {{- ntitle | append: '&nbsp;| ' -}}
      {% endif %}

      {% if product.type == '' and ntitle == '' %}
        {{ product.title | append: '&nbsp;| ' }}
      {% endif %}
      {% break %}
    {% endif %}
  {% endfor %}
{% endif %}

{% if product.collections.size == 1
  or product.collections.size == 0
  or product.type == ''
  and no_color == true
  and product.collections.size <= 1
%}
  {{ product.title }}
{% endif %}

{%- assign no_color = false -%}
{%- assign ntitle = '' -%}
{%- assign colors = '' -%}
