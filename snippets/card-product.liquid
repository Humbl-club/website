{% comment %}
  Renders a product card

  Accepts:
  - card_product: {Object} Product Liquid object (optional)
  - lazy_load: {Boolean} Image should be lazy loaded. Default: true (optional)
  - wrapper_class: {String} Wrapper class for card (optional)

  Usage:
  {% render 'card-product', card_product: product %}
{% endcomment %}

{%- if card_product and card_product != empty -%}
  {% assign image_hover = card_product.media[1] %}

  <div class="card {% if wrapper_class != blank %} {{ wrapper_class }}{% endif %}">
    <button class="card-favorite">
      {% render 'icon-favorite' %}
    </button>

    <div class="card-image img-cover">
      {% if image_hover %}
        <img
          srcset="
            {%- if image_hover.width >= 165 -%}{{ image_hover | image_url: width: 165 }} 165w,{%- endif -%}
            {%- if image_hover.width >= 360 -%}{{ image_hover | image_url: width: 360 }} 360w,{%- endif -%}
            {%- if image_hover.width >= 442 -%}{{ image_hover | image_url: width: 442 }} 442w,{%- endif -%}
            {%- if image_hover.width >= 720 -%}{{ image_hover | image_url: width: 720 }} 720w,{%- endif -%}
            {%- if image_hover.width >= 940 -%}{{ image_hover | image_url: width: 940 }} 940w,{%- endif -%}
            {%- if image_hover.width >= 1066 -%}{{ image_hover | image_url: width: 1066 }} 1066w,{%- endif -%}
            {{ card_product.featured_media | image_url }} {{ card_product.featured_media.width }}w
          "
          class="card-hover"
          src="{{ image_hover | image_url: width: 442 }}"
          alt="{{ image_hover.alt | escape }}"
          {% unless lazy_load == false %}
            loading="lazy"
          {% endunless %}
          width="{{ image_hover.width }}"
          height="{{ image_hover.height }}"
        >
      {% endif %}

      {%- if card_product.featured_media -%}
        {% comment %}theme-check-disable ImgLazyLoading{% endcomment %}
        <img
          srcset="
            {%- if card_product.featured_media.width >= 165 -%}{{ card_product.featured_media | image_url: width: 165 }} 165w,{%- endif -%}
            {%- if card_product.featured_media.width >= 360 -%}{{ card_product.featured_media | image_url: width: 360 }} 360w,{%- endif -%}
            {%- if card_product.featured_media.width >= 442 -%}{{ card_product.featured_media | image_url: width: 442 }} 442w,{%- endif -%}
            {%- if card_product.featured_media.width >= 720 -%}{{ card_product.featured_media | image_url: width: 720 }} 720w,{%- endif -%}
            {%- if card_product.featured_media.width >= 940 -%}{{ card_product.featured_media | image_url: width: 940 }} 940w,{%- endif -%}
            {%- if card_product.featured_media.width >= 1066 -%}{{ card_product.featured_media | image_url: width: 1066 }} 1066w,{%- endif -%}
            {{ card_product.featured_media | image_url }} {{ card_product.featured_media.width }}w
          "
          class="card-img"
          src="{{ card_product.featured_media | image_url: width: 442 }}"
          alt="{{ card_product.featured_media.alt | escape }}"
          {% unless lazy_load == false %}
            loading="lazy"
          {% endunless %}
          width="{{ card_product.featured_media.width }}"
          height="{{ card_product.featured_media.height }}"
        >
        {% comment %}theme-check-enable ImgLazyLoading{% endcomment %}
      {%- endif -%}

      {% assign sizes = '' %}
      {% for option in card_product.options_with_values %}
        {% if option.name == 'Size' %}
          {%- for value in option.values -%}
            {% assign sizes = sizes | append: ',' | append: value | append: ',' %}
          {% endfor %}
        {% endif %}
      {% endfor %}

      {% if sizes != '' %}
        <ul class="card-sizes button-title-4">
          {% for variant in card_product.variants %}
            {% assign ntitle = variant.title | split: '/ ' | first | strip %}
            {% assign ntitle = ',' | append: ntitle | append: ',' %}
            {% if sizes contains ntitle %}
              <li>
                <button
                  {% if variant.available %}
                    class="card-sizebtn available"
                  {% else %}
                    class="card-sizebtn"
                  {% endif %}
                  data-href="{{ variant.url }}"
                >
                  {{- ntitle | remove: ',' -}}
                </button>
              </li>
              {% assign sizes = sizes | remove: ntitle %}
            {% endif %}
          {% endfor %}
        </ul>
      {% endif %}

      <button class="card-cart">
        {% render 'icon-cart' %}
      </button>
    </div>
    <div class="card-bot">
      <h3
        class="card-title body-1"
        {% if card_product.featured_media %}
          id="title-{{ section_id }}-{{ card_product.id }}"
        {% endif %}
      >
        <a
          href="{{ card_product.url }}"
          id="CardLink-{{ section_id }}-{{ card_product.id }}"
        >
          {{ card_product.title | escape }}
        </a>
      </h3>

      {%- render 'price', product: card_product -%}
    </div>
  </div>
{%- else -%}
  <div class="card">
    <div class="card-image"></div>
    <div class="card-bot">
      <h3 class="card-title body-1">
        {{ 'onboarding.product_title' | t }}
      </h3>
      <div class="card-price body-1">
        {{ 1999 | money_without_trailing_zeros }}
      </div>
    </div>
  </div>
{%- endif -%}
